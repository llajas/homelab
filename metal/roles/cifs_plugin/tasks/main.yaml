- name: Install dependencies
  ansible.builtin.dnf:
    name:
      - jq
      - cifs-utils
    state: present

- name: Download CIFS script
  get_url:
    url: https://raw.githubusercontent.com/fstab/cifs/master/cifs
    dest: /tmp/cifs
    mode: '0755'

- name: Create directory for CIFS plugin
  file:
    path: /usr/libexec/kubernetes/kubelet-plugins/volume/exec/fstab~cifs/
    state: directory

- name: Copy CIFS script to the correct directory
  ansible.builtin.copy:
    src: /tmp/cifs
    dest: /usr/libexec/kubernetes/kubelet-plugins/volume/exec/fstab~cifs/
    mode: '0755'
    remote_src: yes